name: Deploy to Qiniu Kodo

on:
  push:
    branches:
      - main
  pull_request:
    types: [closed]
    branches:
      - main

jobs:
  deploy:
    if: github.event.pull_request.merged == true || github.event_name == 'push'
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Install & Build
        run: |
          npm install
          npm run build
      - uses: hujiulong/action-qiniu-upload@master
        with:
          # Your qiniu access key, required.
          access_key: ${{ secrets.QINIU_ACCESS_KEY }}

          # Your qiniu secret key, required.
          secret_key: ${{ secrets.QINIU_SECRET_KEY }}

          # Bucket name, required.
          bucket: retail-outlet-management

          # The local directory (or file) you want to upload to bucket.
          # Default: './'
          source_dir: 'dist'

          # The directory inside of the bucket you want to upload to, namely key prefix prepended to dest file key.
          # Default: '/'
          dest_dir: '/'

          # Overwrite strategy for existing files
          # 'smart' (default): overwrites code files (.html, .js, .css, etc.) but skips media files (.jpg, .png, .mp4, etc.)
          # 'always': always overwrite existing files
          # 'never': never overwrite, skip existing files
          overwrite: 'always'

          # Custom patterns for files to always overwrite (comma-separated)
          # Example: '*.min.js,build/*,dist/*.css'
          overwrite_patterns: ''

          # Custom patterns for files to always skip (comma-separated)
          # Example: '*.log,temp/*'
          skip_patterns: ''

          # Whether to ignore source maps.
          # Default: true
          ignore_source_map: true

          # Support concurrency
          # Default: 5
          concurrency: 5
